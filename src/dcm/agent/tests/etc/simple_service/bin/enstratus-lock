#!/usr/bin/env bash

set -e
set -u

servicePath=$1
lockfile=$2
timeout=$3
serviceName=$4

fname="/tmp/service_lock".$serviceName

date +%s > $fname
echo $@ >> $fname

ls -l $lockfile
sleep 1
touch $lockfile
ls -l $lockfile

read unlock_line

if [ "X$unlock_line" != "XUNLOCK" ]; then
    echo "UNKNOWN COMMAND $unlock_line"
    exit 1
fi
echo "UNLOCKED" >> $fname

exit 0